{% extends "admin/layout.html" %}

{% block content %}
<div class="mb-8 flex items-center justify-between">
  <div>
    <h2 class="text-2xl font-semibold text-white">Organizations</h2>
    <p class="text-sm text-slate-400">Suspend tenants, adjust plan tiers, and inspect billing state.</p>
  </div>
</div>

<div class="overflow-x-auto rounded-xl border border-slate-800 bg-slate-900/50 shadow-xl">
  <table class="min-w-full divide-y divide-slate-800 text-sm">
    <thead class="bg-slate-900/70 text-slate-400 uppercase text-xs">
      <tr>
        <th class="px-4 py-3 text-left">Organization</th>
        <th class="px-4 py-3 text-left">Plan</th>
        <th class="px-4 py-3 text-left">Seats</th>
        <th class="px-4 py-3 text-left">Subscription</th>
        <th class="px-4 py-3 text-left">Activity</th>
        <th class="px-4 py-3">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-slate-800">
      {% for org in organizations %}
      <tr>
        <td class="px-4 py-4 align-top">
          <div class="font-semibold text-white">{{ org.name }}</div>
          <p class="text-xs text-slate-500">{{ org.slug }}</p>
          <p class="text-xs text-slate-500">Stripe: {{ org.stripe_customer_id or 'n/a' }}</p>
        </td>
        <td class="px-4 py-4 align-top">
          <form method="post" action="/admin/orgs/{{ org.id }}/change-plan" class="space-y-2">
            <select name="plan" class="w-full rounded-md border border-slate-700 bg-slate-800/80 px-2 py-1 text-sm">
              {% for plan in plan_options %}
              <option value="{{ plan }}" {% if plan == org.plan_tier %}selected{% endif %}>{{ plan|title }}</option>
              {% endfor %}
            </select>
            <button type="submit" class="w-full rounded-md bg-emerald-500/20 px-2 py-1 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/30">Update</button>
          </form>
        </td>
        <td class="px-4 py-4 align-top">
          <p class="text-lg font-semibold text-white">{{ org.member_count }}/{{ org.seat_limit }}</p>
          <p class="text-xs text-slate-500">Active scans: {{ org.active_scans }}</p>
          <p class="text-xs text-slate-500">Pending jobs: {{ org.pending_jobs }}</p>
        </td>
        <td class="px-4 py-4 align-top">
          <p class="text-sm text-white">{{ org.subscription_status|title }}</p>
          <p class="text-xs text-slate-500">Renews {{ org.subscription_renews_at.strftime('%Y-%m-%d') if org.subscription_renews_at else 'n/a' }}</p>
          <p class="text-xs text-slate-500">Sub: {{ org.stripe_subscription_id or 'n/a' }}</p>
        </td>
        <td class="px-4 py-4 align-top">
          <p class="text-xs text-slate-400">Created {{ org.created_at.strftime('%Y-%m-%d') }}</p>
          <p class="text-xs text-slate-400">Next run: {{ org.next_schedule.strftime('%Y-%m-%d %H:%M') if org.next_schedule else 'n/a' }}</p>
          {% if not org.is_active %}
          <span class="mt-1 inline-flex items-center rounded-full bg-amber-500/20 px-2 py-0.5 text-[10px] font-semibold uppercase tracking-widest text-amber-300">Suspended</span>
          {% endif %}
        </td>
        <td class="px-4 py-4 align-top space-y-2">
          <form method="post" action="/admin/orgs/{{ org.id }}/force-scan">
            <button class="w-full rounded-md bg-slate-800 px-3 py-1 text-xs font-semibold text-white hover:bg-slate-700">Force Scan</button>
          </form>
          {% if org.is_active %}
          <form method="post" action="/admin/orgs/{{ org.id }}/suspend">
            <button class="w-full rounded-md bg-rose-500/20 px-3 py-1 text-xs font-semibold text-rose-200 hover:bg-rose-500/30">Suspend</button>
          </form>
          {% else %}
          <form method="post" action="/admin/orgs/{{ org.id }}/activate">
            <button class="w-full rounded-md bg-emerald-500/20 px-3 py-1 text-xs font-semibold text-emerald-200 hover:bg-emerald-500/30">Activate</button>
          </form>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="px-4 py-6 text-center text-slate-500">No organizations found.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
